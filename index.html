<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Invoice App">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#007ACC">
    <title>HVAC Invoice Generator</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <div class="container">
        <header>
            <h1>‚ùÑÔ∏è Corcho Invoice Generator</h1>
            <nav class="main-nav">
                <button class="nav-btn active" onclick="showSection('invoice')">New Invoice</button>
                <button class="nav-btn" onclick="showSection('customers')">Customers</button>
                <button class="nav-btn" onclick="showSection('workLocations')">Work Locations</button>
                <button class="nav-btn" onclick="showSection('history')">History</button>
                <button class="nav-btn" onclick="showSection('settings')">Settings</button>
            </nav>
        </header>

        <!-- INVOICE SECTION -->
        <section id="invoice" class="section active">
            <div class="section-header">
                <h2>Create New Invoice</h2>
            </div>
            
            <!-- Customer Information -->
            <div class="card">
                <h3>Customer Information</h3>
                <div class="form-row">
                    <select id="customerSelect" class="input" onchange="loadCustomerData()">
                        <option value="">Select customer...</option>
                    </select>
                    <button onclick="showSection('customers')" class="btn secondary">Manage Customers</button>
                </div>
                <div class="form-row">
                    <input type="text" id="customerName" placeholder="Customer Name" class="input">
                    <input type="text" id="customerAddress" placeholder="Address" class="input">
                </div>
                <div class="form-row">
                    <input type="email" id="customerEmail" placeholder="Email" class="input">
                    <input type="text" id="customerPhone" placeholder="Phone" class="input">
                </div>
            </div>

            <!-- Work Location -->
            <div class="card">
                <h3>Work Location</h3>
                <div class="form-row">
                    <select id="workLocationSelect" class="input" onchange="loadWorkLocationData()">
                        <option value="">Select work location...</option>
                        <option value="new">+ Add New Location</option>
                    </select>
                </div>
                <div class="form-row">
                    <input type="text" id="workLocationName" placeholder="Location Name" class="input">
                    <input type="text" id="workLocationAddress" placeholder="Address" class="input">
                </div>
                <div class="form-row">
                    <input type="text" id="workLocationCity" placeholder="City" class="input">
                    <input type="text" id="workLocationState" placeholder="State" class="input">
                    <input type="text" id="workLocationZip" placeholder="Zip Code" class="input">
                </div>
            </div>

            <!-- Invoice Details -->
            <div class="card">
                <h3>Invoice Details</h3>
                <div class="form-row">
                    <input type="text" id="invoiceNumber" placeholder="Invoice Number" class="input">
                    <input type="date" id="invoiceDate" class="input">
                </div>
            </div>

            <!-- Items -->
            <div class="card">
                <h3>Invoice Items</h3>
                <div class="item-form">
                    <textarea id="itemDescription" placeholder="Item Description (supports multiple lines)" class="input textarea" rows="3"></textarea>
                    <input type="number" id="itemQuantity" placeholder="Qty" class="input small" min="1" value="1">
                    <input type="number" id="itemPrice" placeholder="Unit Price" step="0.01" class="input small">
                    <button onclick="addItem()" class="btn">Add Item</button>
                </div>
                
                <div id="itemsList" class="items-list"></div>
                
                <div class="summary">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span>$<span id="subtotal">0.00</span></span>
                    </div>
                    <div class="summary-row">
                        <span>Tax (%):</span>
                        <div>
                            <input type="number" id="taxRate" value="0" min="0" max="100" step="0.1" class="input tiny" onchange="calculateTotal()">%
                        </div>
                    </div>
                    <div class="summary-row">
                        <span>Tax Amount:</span>
                        <span>$<span id="taxAmount">0.00</span></span>
                    </div>
                    <div class="summary-row total">
                        <strong>Total:</strong>
                        <strong>$<span id="totalAmount">0.00</span></strong>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="actions">
                <button onclick="clearInvoice()" class="btn secondary">Clear All</button>
                <button onclick="saveDraft()" class="btn">Save Draft</button>
                <button onclick="generatePDF()" class="btn primary">Generate PDF</button>
                <button onclick="shareInvoice()" class="btn success" id="shareBtn" style="display: none;">Share Invoice</button>
            </div>
        </section>

        <!-- CUSTOMERS SECTION -->
        <section id="customers" class="section">
            <div class="section-header">
                <h2>Customer Management</h2>
                <button onclick="showNewCustomerForm()" class="btn primary">Add New Customer</button>
            </div>

            <!-- Customer Form -->
            <div class="card" id="customerForm" style="display: none;">
                <h3 id="customerFormTitle">Add New Customer</h3>
                <div class="form-row">
                    <input type="text" id="newCustomerName" placeholder="Customer Name" class="input">
                    <input type="text" id="newCustomerPhone" placeholder="Phone" class="input">
                </div>
                <div class="form-row">
                    <input type="email" id="newCustomerEmail" placeholder="Email" class="input">
                    <input type="text" id="newCustomerAddress" placeholder="Address" class="input">
                </div>
                <div class="form-actions">
                    <button onclick="hideCustomerForm()" class="btn secondary">Cancel</button>
                    <button onclick="saveCustomer()" class="btn primary">Save Customer</button>
                </div>
            </div>

            <!-- Customers List -->
            <div class="card">
                <h3>Saved Customers</h3>
                <div id="customersList" class="customers-list"></div>
            </div>
        </section>

        <!-- WORK LOCATIONS SECTION -->
        <section id="workLocations" class="section">
            <div class="section-header">
                <h2>Work Locations Management</h2>
                <button onclick="showNewWorkLocationForm()" class="btn primary">Add New Location</button>
            </div>

            <!-- Work Location Form -->
            <div class="card" id="workLocationForm" style="display: none;">
                <h3 id="workLocationFormTitle">Add New Work Location</h3>
                <div class="form-row">
                    <input type="text" id="newLocationName" placeholder="Location Name" class="input">
                    <input type="text" id="newLocationAddress" placeholder="Address" class="input">
                </div>
                <div class="form-row">
                    <input type="text" id="newLocationCity" placeholder="City" class="input">
                    <input type="text" id="newLocationState" placeholder="State" class="input">
                    <input type="text" id="newLocationZip" placeholder="Zip Code" class="input">
                </div>
                <div class="form-actions">
                    <button onclick="hideWorkLocationForm()" class="btn secondary">Cancel</button>
                    <button onclick="saveWorkLocation()" class="btn primary">Save Location</button>
                </div>
            </div>

            <!-- Work Locations List -->
            <div class="card">
                <h3>Saved Work Locations</h3>
                <div id="workLocationsList" class="customers-list"></div>
            </div>
        </section>

       <!-- HISTORY SECTION -->
<section id="history" class="section">
    <div class="section-header">
        <h2>Invoice History</h2>
        <div>
            <button onclick="exportData()" class="btn secondary">Export Data</button>
            <input type="file" id="importFile" accept=".json" onchange="importData(event)" style="display: none;">
            <button onclick="document.getElementById('importFile').click()" class="btn secondary">Import Data</button>
        </div>
    </div>

    <div class="card">
        <div class="history-filters">
            <input type="text" id="searchHistory" placeholder="Search invoices..." class="input" onkeyup="filterHistory()">
            <select id="customerFilter" class="input" onchange="filterHistory()">
                <option value="">All Customers</option>
            </select>
        </div>
        
        <div id="historyList" class="history-list"></div>
    </div>
</section>

        <!-- SETTINGS SECTION -->
        <section id="settings" class="section">
            <div class="section-header">
                <h2>Settings</h2>
            </div>
<div class="card">
    <h3>App Installation</h3>
    <p>Install this app on your device for quick access:</p>
    <button onclick="installPWA()" class="btn success" id="installBtn" style="display: none;">
        üì± Install App
    </button>
    <p id="pwaStatus">PWA installation not available</p>
</div>
            <div class="card">
                <h3>Business Information</h3>
                <div class="form-row">
                    <input type="text" id="businessName" placeholder="Your Business Name" class="input">
                    <input type="text" id="businessSlogan" placeholder="Business Slogan" class="input">
                </div>
                <div class="form-row">
                    <input type="text" id="businessAddress" placeholder="Business Address" class="input">
                    <input type="text" id="businessPhone" placeholder="Business Phone" class="input">
                </div>
                <div class="form-row">
                    <input type="email" id="businessEmail" placeholder="Business Email" class="input">
                    <input type="text" id="businessTaxId" placeholder="Tax ID" class="input">
                </div>
                <button onclick="saveBusinessInfo()" class="btn primary">Save Business Info</button>
            </div>

            <div class="card">
                <h3>Data Management</h3>
                <div class="settings-actions">
                    <button onclick="exportData()" class="btn secondary">Export All Data</button>
                    <button onclick="document.getElementById('importFile').click()" class="btn secondary">Import Data</button>
                    <button onclick="clearAllData()" class="btn danger">Clear All Data</button>
                </div>
                <div class="data-stats">
                    <p>Customers: <span id="customersCount">0</span></p>
                    <p>Work Locations: <span id="locationsCount">0</span></p>
                    <p>Invoices: <span id="invoicesCount">0</span></p>
                    <p>Storage Used: <span id="storageUsed">0 KB</span></p>
                </div>
            </div>

            <div class="card">
                <h3>Invoice Settings</h3>
                <div class="form-row">
                    <label>
                        Default Tax Rate (%):
                        <input type="number" id="defaultTaxRate" value="0" min="0" max="100" step="0.1" class="input tiny">
                    </label>
                    <label>
                        Invoice Prefix:
                        <input type="text" id="invoicePrefix" value="INV-" class="input tiny">
                    </label>
                </div>
                <button onclick="saveInvoiceSettings()" class="btn primary">Save Settings</button>
            </div>
        </section>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="script.js"></script>
<script>
    // Register Service Worker for PWA
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
            navigator.serviceWorker.register('./sw.js')
                .then(function(registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                })
                .catch(function(error) {
                    console.log('ServiceWorker registration failed: ', error);
                });
        });
    }

    // Show install prompt for PWA
    let deferredPrompt;
    const installButton = document.createElement('button');
    
    window.addEventListener('beforeinstallprompt', (e) => {
        // Prevent the mini-infobar from appearing on mobile
        e.preventDefault();
        // Stash the event so it can be triggered later
        deferredPrompt = e;
        
        // Create and show install button
        installButton.textContent = 'üì± Install App';
        installButton.className = 'btn success';
        installButton.style.position = 'fixed';
        installButton.style.bottom = '20px';
        installButton.style.right = '20px';
        installButton.style.zIndex = '1000';
        installButton.onclick = installPWA;
        
        document.body.appendChild(installButton);
    });

    function installPWA() {
        if (deferredPrompt) {
            // Show the install prompt
            deferredPrompt.prompt();
            // Wait for the user to respond to the prompt
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('User accepted the install prompt');
                } else {
                    console.log('User dismissed the install prompt');
                }
                deferredPrompt = null;
                // Remove the install button
                installButton.remove();
            });
        }
    }

    // Detect if the app is launched as PWA
    window.addEventListener('appinstalled', (evt) => {
        console.log('App was installed as PWA');
        installButton.remove();
    });

    // Check if running as PWA
    if (window.matchMedia('(display-mode: standalone)').matches) {
        console.log('Running as PWA');
    }
</script>
</body>
</html>